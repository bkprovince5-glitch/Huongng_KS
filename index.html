<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khảo sát ý kiến về Dự thảo Quy trình nghiệp vụ khung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- Global styles and mobile-first approach --- */
        :root {
            /* Màu nền và màu sắc chính */
            --bg-start-color: #f0e9ff;
            --bg-end-color: #d1efff;
            --card-bg: rgba(255, 255, 255, 0.3);
            --card-border: rgba(255, 255, 255, 0.7);
            --text-color: #333;
            
            /* Màu sắc mới cho biểu đồ */
            --chart-color-1: #4C8BF5; /* Blue */
            --chart-color-2: #34A853; /* Green */
            --chart-color-3: #FBBC05; /* Yellow */
            --chart-color-4: #EA4335; /* Red */
            --chart-color-5: #9C27B0; /* Purple */

            /* Hiệu ứng nền */
            --bubble-color: rgba(255, 255, 255, 0.5);
            --sparkle-color: rgba(255, 255, 255, 0.95);
            --glow-color: rgba(197, 240, 255, 0.8);
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, var(--bg-start-color) 0%, var(--bg-end-color) 100%);
            color: var(--text-color);
            position: relative;
            padding: 20px;
        }

        /* Background Effects */
        .background-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden; 
        }
        
        .bubble, .sparkle, .droplet {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }
        
        .bubble {
            background: var(--bubble-color);
            box-shadow: 0 0 15px var(--glow-color);
            animation: bubbleFloat 6s ease-in-out infinite;
        }
        
        .bubble:nth-child(1) { width: 60px; height: 60px; top: 10%; left: 15%; animation-delay: 0s; }
        .bubble:nth-child(2) { width: 40px; height: 40px; top: 70%; right: 20%; animation-delay: 2s; }
        .bubble:nth-child(3) { width: 80px; height: 80px; top: 30%; right: 10%; animation-delay: 4s; }
        .bubble:nth-child(4) { width: 30px; height: 30px; bottom: 20%; left: 25%; animation-delay: 1s; }
        .bubble:nth-child(5) { width: 50px; height: 50px; top: 50%; left: 70%; animation-delay: 3s; }
        @keyframes bubbleFloat {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.7; }
            50% { transform: translateY(-20px) scale(1.1); opacity: 0.9; }
        }

        .sparkle {
            width: 3px;
            height: 3px;
            background: var(--sparkle-color);
            box-shadow: 0 0 10px var(--sparkle-color);
            animation: sparkleShine 3s linear infinite;
        }
        .sparkle:nth-child(6) { top: 20%; left: 30%; animation-delay: 0s; }
        .sparkle:nth-child(7) { top: 60%; right: 30%; animation-delay: 1s; }
        .sparkle:nth-child(8) { bottom: 40%; left: 60%; animation-delay: 2s; }
        .sparkle:nth-child(9) { top: 40%; left: 80%; animation-delay: 0.5s; }
        @keyframes sparkleShine {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }
        
        .droplet {
            width: 10px; height: 10px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(220, 255, 220, 0.6) 40%, transparent 100%);
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8), 0 2px 5px rgba(0, 0, 0, 0.1);
            animation: dropletShine 5s ease-in-out infinite;
        }
        .droplet:nth-child(10) { top: 25%; left: 20%; animation-delay: 0s; }
        .droplet:nth-child(11) { top: 70%; right: 15%; animation-delay: 2s; }
        .droplet:nth-child(12) { bottom: 30%; left: 70%; animation-delay: 3s; }
        @keyframes dropletShine {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* Main Glassmorphism Card */
        .glass-card {
            backdrop-filter: blur(30px);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.15) 100%);
            border: 1px solid rgba(255, 255, 255, 0.7);
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .glass-card:hover {
            transform: translateY(-5px) scale(1.005);
            box-shadow: 0 35px 70px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }
        
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #FF77BB, #6ADBEF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-weight: 600;
            text-align: center;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.15) 100%);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease-in-out;
            backdrop-filter: blur(15px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .form-section:hover {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .form-section h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--text-color);
            font-weight: 600;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-color);
        }
        
        p.question-note {
            margin-bottom: 15px;
            color: #555;
        }

        input[type="text"],
        input[type="email"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(150, 150, 150, 0.5);
            background: rgba(255, 255, 255, 0.5);
            resize: vertical;
            font-family: 'Montserrat', sans-serif;
            color: var(--text-color);
            transition: all 0.3s ease;
            outline: none;
            backdrop-filter: blur(10px);
            margin-top: 5px;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus,
        select:focus {
            background: rgba(255, 255, 255, 0.7);
            border-color: rgba(90, 90, 90, 0.7);
            box-shadow: 0 0 10px var(--glow-color);
        }

        /* Custom Radio Buttons */
        .radio-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            position: relative;
            user-select: none;
            padding: 8px 12px;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.2s ease-in-out;
        }

        .radio-item:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        
        .radio-item input[type="radio"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            position: relative;
            height: 20px;
            width: 20px;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            border: 2px solid #a3a3a3;
            margin-right: 10px;
            transition: all 0.2s ease-in-out;
        }

        .radio-item input[type="radio"]:checked ~ .checkmark {
            background-color: #5c99ff;
            border-color: #5c99ff;
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: white;
        }

        .radio-item input[type="radio"]:checked ~ .checkmark:after {
            display: block;
        }

        .btn {
            background: linear-gradient(135deg, #FF77BB, #6ADBEF);
            backdrop-filter: blur(20px);
            border: none;
            border-radius: 50px;
            padding: 18px 40px;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .form-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.7) 100%);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 400px;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        .loading-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #FF77BB;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results-container h2,
        .results-container h3 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--text-color);
        }
        
        .detailed-result-card {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            backdrop-filter: blur(15px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: none; /* Ban đầu ẩn tất cả */
        }
        
        .detailed-result-card.visible {
            display: block; /* Hiển thị khi khớp tìm kiếm */
        }

        .detailed-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-color);
            position: relative;
        }
        
        .detailed-result-header.active {
            border-bottom: 1px solid rgba(255, 255, 255, 0.8);
        }

        .detailed-result-header .toggle-icon {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .detailed-result-header.active .toggle-icon {
            transform: rotate(180deg);
        }

        .detailed-result-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            padding: 0 20px;
        }

        .detailed-result-content.active {
            max-height: 2000px; /* A large value to allow content to expand */
            padding: 20px;
        }

        .question-detail {
            margin-bottom: 15px;
        }
        
        .question-detail strong {
            display: block;
            margin-bottom: 5px;
            color: #555;
        }

        .summary-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.3);
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        .summary-item .label {
            display: flex;
            align-items: center;
        }

        .summary-item .color-box {
            width: 15px;
            height: 15px;
            border-radius: 4px;
            margin-right: 10px;
        }

        .summary-text-box {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-top: 15px;
            display: none;
        }
        
        .summary-text-box.active {
            display: block;
        }
        .summary-text-box h4 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #444;
        }
        .summary-text-box ul {
            list-style-type: disc;
            padding-left: 20px;
        }
        .summary-text-box ul li {
            margin-bottom: 5px;
            color: #555;
        }
        
        /* Table styles for summary */
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .summary-table th, .summary-table td {
            padding: 12px 15px;
            text-align: left;
            border: 1px solid rgba(255, 255, 255, 0.7);
        }
        .summary-table thead {
            background-color: rgba(255, 255, 255, 0.5);
        }
        .summary-table tbody tr {
            background-color: rgba(255, 255, 255, 0.3);
            transition: background-color 0.3s ease;
        }
        .summary-table tbody tr:hover {
            background-color: rgba(255, 255, 255, 0.5);
        }

    </style>
</head>
<body class="bg-gradient-to-br from-purple-200 to-blue-200 min-h-screen flex items-center justify-center p-4 text-gray-800">

    <!-- Background Effects -->
    <div class="background-effects">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="droplet"></div>
        <div class="droplet"></div>
        <div class="droplet"></div>
    </div>
    
    <div class="container mx-auto max-w-4xl p-8 lg:p-12 glass-card">
        <h1 id="mainTitle" class="text-4xl font-bold mb-8 text-center text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400">Khảo sát ý kiến về Dự thảo Quy trình nghiệp vụ khung</h1>
        
        <div id="surveyContainer">
            <form id="surveyForm" class="space-y-6">
                <!-- Phần thông tin người trả lời -->
                <div class="form-section">
                    <h2 class="text-2xl font-semibold mb-4">Thông tin người trả lời</h2>
                    <div class="mb-4">
                        <label for="respondent_name" class="block font-medium mb-1">1. Tên người trả lời khảo sát:</label>
                        <input type="text" id="respondent_name" placeholder="Họ và tên..." class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all" list="employees" oninput="updateUnit()">
                        <datalist id="employees"></datalist>
                    </div>
                    <div>
                        <label for="unit" class="block font-medium mb-1">2. Đơn vị công tác:</label>
                        <input type="text" id="unit" placeholder="Ví dụ: Cục Thuế Hà Nội" class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all">
                    </div>
                </div>
                
                <!-- Phần I: Về dự thảo các quy trình nghiệp vụ khung -->
                <div class="form-section">
                    <h2 class="text-2xl font-semibold mb-4">Phần I: Về dự thảo các quy trình nghiệp vụ khung</h2>
                    <div class="mb-4">
                        <p class="mb-2 font-medium">1.1. Về Phương pháp và Cách thức xây dựng quy trình:</p>
                        <p class="text-sm text-gray-600 italic mb-3">Bạn đánh giá thế nào về phương pháp tiếp cận và các bước xây dựng quy trình hiện tại? Liệu chúng đã phù hợp để giải quyết vấn đề quản lý thuế theo mục tiêu đề ra chưa?</p>
                        <textarea id="q1_1" placeholder="Ý kiến của bạn..." rows="4" class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"></textarea>
                    </div>
                    <div>
                        <p class="mb-2 font-medium">1.2. Cần điều chỉnh, bổ sung những nội dung nào trong phương pháp xây dựng quy trình để đảm bảo hiệu quả hơn?</p>
                        <textarea id="q1_2" placeholder="Ý kiến của bạn..." rows="4" class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"></textarea>
                    </div>
                </div>

                <!-- Phần II: Về việc đáp ứng các yêu cầu cốt lõi -->
                <div class="form-section">
                    <h2 class="text-2xl font-semibold mb-4">Phần II: Về việc đáp ứng các yêu cầu cốt lõi</h2>
                    <p class="mb-3">2. Dự thảo quy trình khung đã đáp ứng đầy đủ các yêu cầu sau đây chưa? (Vui lòng chọn Có/Không cho mỗi yêu cầu)</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white bg-opacity-30 rounded-xl p-4 backdrop-blur-sm border border-white border-opacity-50 shadow-sm">
                            <p class="font-medium text-gray-700 mb-2">(i) Quản lý theo đối tượng</p>
                            <div class="flex space-x-4">
                                <label class="radio-item">
                                    <input type="radio" name="q2_i" value="Có" required />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Có</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q2_i" value="Không" />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Không</span>
                                </label>
                            </div>
                        </div>
                         <div class="bg-white bg-opacity-30 rounded-xl p-4 backdrop-blur-sm border border-white border-opacity-50 shadow-sm">
                            <p class="font-medium text-gray-700 mb-2">(ii) Lấy Người nộp thuế (NNT) làm trung tâm</p>
                            <div class="flex space-x-4">
                                <label class="radio-item">
                                    <input type="radio" name="q2_ii" value="Có" required />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Có</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q2_ii" value="Không" />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Không</span>
                                </label>
                            </div>
                        </div>
                         <div class="bg-white bg-opacity-30 rounded-xl p-4 backdrop-blur-sm border border-white border-opacity-50 shadow-sm">
                            <p class="font-medium text-gray-700 mb-2">(iii) Tuân thủ các quy định hiện hành</p>
                            <div class="flex space-x-4">
                                <label class="radio-item">
                                    <input type="radio" name="q2_iii" value="Có" required />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Có</span>
                                </label>
                                <label class="radio-item">
                                    <input type="radio" name="q2_iii" value="Không" />
                                    <span class="checkmark"></span>
                                    <span class="text-gray-700">Không</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Phần III: Về Sự đầy đủ và Yêu cầu dữ liệu -->
                <div class="form-section">
                    <h2 class="text-2xl font-semibold mb-4">Phần III: Về Sự đầy đủ và Yêu cầu dữ liệu</h2>
                    <div class="mb-4">
                        <p class="mb-2 font-medium">3.1. Theo bạn, Dự thảo quy trình khung đã bao gồm đầy đủ các bước nghiệp vụ cần thiết chưa?</p>
                        <div class="flex space-x-4">
                            <label class="radio-item">
                                <input type="radio" name="q3_1" value="Có" required />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Có</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="q3_1" value="Không" />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Không</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="q3_2" class="block font-medium mb-1">3.2. Cần bổ sung thêm những bước nghiệp vụ hoặc yêu cầu thông tin, dữ liệu nào?</label>
                        <textarea id="q3_2" placeholder="Ý kiến của bạn..." rows="4" class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"></textarea>
                    </div>
                </div>

                <!-- Phần IV: Về tính khả thi của kế hoạch tháng 8/2025 -->
                <div class="form-section">
                    <h2 class="text-2xl font-semibold mb-4">Phần IV: Về tính khả thi của kế hoạch tháng 8/2025</h2>
                    <div class="mb-4">
                        <p class="mb-2 font-medium">4.1. Bạn đánh giá thế nào về tính khả thi của kế hoạch hoàn thành các quy trình trong tháng 8/2025?</p>
                        <div class="flex flex-wrap gap-4">
                            <label class="radio-item">
                                <input type="radio" name="q4_1" value="Rất khả thi" required />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Rất khả thi</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="q4_1" value="Khả thi" />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Khả thi</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="q4_1" value="Bình thường" />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Bình thường</span>
                            </label>
                            <label class="radio-item">
                                <input type="radio" name="q4_1" value="Không khả thi" />
                                <span class="checkmark"></span>
                                <span class="text-gray-700">Không khả thi</span>
                            </label>
                        </div>
                    </div>
                    <div>
                        <label for="q4_2" class="block font-medium mb-1">4.2. Đề xuất của bạn là gì để đảm bảo về mặt thời gian cũng như chất lượng?</label>
                        <textarea id="q4_2" placeholder="Đề xuất của bạn..." rows="4" class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all"></textarea>
                    </div>
                </div>

                <div class="flex justify-center space-x-4 mt-6">
                    <button type="submit" id="submitBtn" class="btn">Gửi ý kiến</button>
                    <button type="button" class="btn" onclick="switchView('results')">Xem kết quả</button>
                </div>
            </form>
        </div>
        
        <div id="resultsContainer" class="hidden">
            <div class="text-center font-playfair mb-8">
                <h2 class="text-4xl text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400">Tổng hợp kết quả khảo sát</h2>
            </div>
            
            <div id="resultsContent" class="space-y-6">
                <!-- Nội dung kết quả sẽ được tạo động tại đây -->
            </div>

            <div class="flex justify-center mt-8">
                <button id="backToFormBtn" class="btn" onclick="switchView('form')">Quay lại Biểu mẫu</button>
            </div>
        </div>
    </div>

    <!-- Custom Modal for Notifications -->
    <div id="custom-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="text-4xl mb-4" id="modal-icon"></div>
            <p id="modal-message" class="text-xl font-semibold"></p>
        </div>
    </div>
    
    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, setDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // =========================================================================
        // === HƯỚNG DẪN: Cấu hình Firebase cho ứng dụng chạy độc lập ===
        // =========================================================================
        // Để ứng dụng này hoạt động khi bạn xuất file HTML, bạn cần cung cấp thông tin cấu hình 
        // của dự án Firebase của riêng bạn.
        // 
        // 1. Truy cập vào Firebase Console: https://console.firebase.google.com/
        // 2. Tạo một dự án mới (hoặc chọn một dự án đã có).
        // 3. Trong giao diện dự án, thêm một ứng dụng Web.
        // 4. Sao chép đoạn code cấu hình (firebaseConfig) mà Firebase cung cấp.
        // 5. Dán đoạn code đó vào biến 'firebaseConfig' bên dưới.
        // 6. Sau đó, bạn cần thiết lập Firestore. Trong Firebase Console, vào mục 
        //    'Firestore Database', tạo cơ sở dữ liệu và chọn chế độ 'start in test mode' 
        //    để có thể đọc/ghi dữ liệu tạm thời.
        //
        // Cần lưu ý rằng dữ liệu được lưu trữ sẽ nằm trong tài khoản Firebase của bạn, 
        // không còn trong môi trường cộng tác này nữa.
        // =========================================================================

        const firebaseConfig = {
  apiKey: "AIzaSyA4H9rXeYjn4P1dTtd3KJ50ZhhTytM75h8",
  authDomain: "huong-47bd2.firebaseapp.com",
  projectId: "huong-47bd2",
  storageBucket: "huong-47bd2.firebasestorage.app",
  messagingSenderId: "920679228673",
  appId: "1:920679228673:web:fa0d71704306d51f1ce700",
  measurementId: "G-1QCRYEHY2V"
};
        
        // --- Firebase Initialization and Authentication ---
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        let isAuthReady = false;

        // Sign in anonymously for simple access
        const setupAuth = async () => {
            try {
                // Tự động đăng nhập ẩn danh khi chạy ứng dụng độc lập
                await signInAnonymously(auth);
                isAuthReady = true;
                console.log("User signed in anonymously.");
            } catch (error) {
                console.error("Firebase Auth Error:", error);
                showModal("Lỗi xác thực Firebase, vui lòng kiểm tra cấu hình.", "error");
            }
        };

        // --- Dữ liệu mẫu về nhân viên để hỗ trợ tìm kiếm (Search help) ---
        const employeeData = [
            { name: 'Đoàn Xuân Toản', unit: 'Văn phòng' },
            { name: 'Nguyễn Thị Thu', unit: 'Ban NVT' },
            { name: 'Nguyễn Thu Trà', unit: 'Ban QLTT' },
            { name: 'Nguyễn Thị Thanh Hằng', unit: 'Ban CS' },
            { name: 'Nguyễn Đức Dương', unit: 'Ban TVQT' },
            { name: 'Nguyễn Thị Lan Anh', unit: 'Ban PC' },
            { name: 'Nguyễn Tiến Trung', unit: 'Ban KT' },
            { name: 'Phạm Thị Tuyết Lan', unit: 'Ban DTTK' },
            { name: 'Dương Văn Hùng', unit: 'Ban TCCB' },
            { name: 'Phạm Quang Toàn', unit: 'Ban CĐS' },
            { name: 'Cáp Quý Phúc', unit: 'CCT TMĐT' },
            { name: 'Lưu Nguyên Trí', unit: 'Ban CĐS' },
            { name: 'Phạm Thị Minh Hiền', unit: 'Ban CS' },
            { name: 'Kiều Ngọc Anh', unit: 'Ban DTTK' },
            { name: 'Lê Thị Chinh', unit: 'Ban NVT' },
            { name: 'Nguyễn Thị Thu Hường', unit: 'Ban NVT' },
            { name: 'Nguyễn Minh Thao', unit: 'Ban PC' },
            { name: 'Nguyễn Thị Huyền Mỹ', unit: 'Ban QLTT' },
            { name: 'Đào Duy Bẩy', unit: 'Ban QLTT' },
            { name: 'Nguyễn Tiến Quỳnh', unit: 'Ban TCCB' },
            { name: 'Tô Kim Phượng', unit: 'Ban KT' },
            { name: 'Nguyễn Nam Hải', unit: 'Ban KT' },
            { name: 'Bùi Xuân Thành', unit: 'Ban TVQT' },
            { name: 'Nguyễn Tiến Hưng', unit: 'CCT DNL' },
            { name: 'Ngô Thị Thùy Linh', unit: 'CCT TMĐT' },
            { name: 'Lê Thị Thanh Vân', unit: 'CCT DNL' },
            { name: 'Nguyễn Thị Kim Oanh', unit: 'CCT DNL' },
            { name: 'Lương Hồng Hải', unit: 'CCT DNL' },
            { name: 'Nguyễn Thị Thùy Linh', unit: 'CCT TMĐT' },
            { name: 'Đặng Thị Dịu', unit: 'Ban CĐS' },
            { name: 'Nguyễn Thị Tuyết Lê', unit: 'Ban CĐS' },
            { name: 'Nguyễn Mạnh Tùng', unit: 'Ban CĐS' },
            { name: 'Lê Thị Hiền', unit: 'Ban CĐS' },
            { name: 'Trương Phương Thảo', unit: 'Ban CS' },
            { name: 'Nguyễn Thị Lan Hương', unit: 'Ban CS' },
            { name: 'Nguyễn Ngọc Oanh', unit: 'Ban DTTK' },
            { name: 'Vũ Thị Thúy', unit: 'Ban DTTK' },
            { name: 'Lê Mai Quyên', unit: 'Ban PC' },
            { name: 'Nguyễn Thu Hồng', unit: 'Ban PC' },
            { name: 'Phạm Quang Hưng', unit: 'Ban PC' },
            { name: 'Phạm Mạnh Cường', unit: 'Ban QLTT' },
            { name: 'Nguyễn Thị Ngọc Thu', unit: 'Ban QLTT' },
            { name: 'Nguyễn Mạnh Hùng', unit: 'Ban QLTT' },
            { name: 'Bùi Nam Thắng', unit: 'Ban QLTT' },
            { name: 'Nguyễn Vũ Thùy Dương', unit: 'Ban QLTT' },
            { name: 'Nguyễn Hải Hà', unit: 'Ban QLTT' },
            { name: 'Nguyễn Thương Huyền', unit: 'Ban QLTT' },
            { name: 'Đào Anh Trang', unit: 'Ban QLTT' },
            { name: 'Trần Hồng Quân', unit: 'Ban TCCB' },
            { name: 'Nguyễn Xuân Tú', unit: 'Ban TCCB' },
            { name: 'Hoàng Đình Cường', unit: 'Ban KT' },
            { name: 'Ngô Thị Thu Hương', unit: 'Ban KT' },
            { name: 'Nguyễn Thị Mai Hương', unit: 'Ban KT' },
            { name: 'Đàm Ngọc Linh', unit: 'Ban KT' },
            { name: 'Phạm Thị Hà (NVT)', unit: 'Ban NVT' },
            { name: 'Trần Thị Quỳnh Anh', unit: 'Ban KT' },
            { name: 'Nguyễn Thị Hoài Hương', unit: 'Ban KT' },
            { name: 'Trần Thị Thu Thắm', unit: 'Ban KT' },
            { name: 'Vũ Thị Huyền', unit: 'Ban KT' },
            { name: 'Nguyễn Tuấn Anh', unit: 'Ban KT' },
            { name: 'Phạm Thị Hà (KT)', unit: 'Ban KT' },
            { name: 'Trần Văn Cường', unit: 'Ban KT' },
            { name: 'Nguyễn Hồng Hạnh', unit: 'Ban TVQT' },
            { name: 'Hoàng Thị Gấm', unit: 'Ban TVQT' },
            { name: 'Lưu Thị Tân Phương', unit: 'Ban NVT' },
            { name: 'Nguyễn Thị Ánh Nguyệt', unit: 'Ban NVT' },
            { name: 'Ngôn Thị Mai Hương', unit: 'Ban NVT' },
            { name: 'Bùi Việt Hà', unit: 'Ban NVT' },
            { name: 'Giang Bảo Ngọc', unit: 'Ban NVT' },
            { name: 'Phạm Thị Lan Anh', unit: 'Ban NVT' },
            { name: 'Bùi Thanh Hương', unit: 'Ban NVT' },
            { name: 'Đỗ Hoàng Tuấn', unit: 'Ban NVT' },
            { name: 'Trần Thị Thu Huyền', unit: 'Ban NVT' },
            { name: 'Bùi Thị Bích Hạnh', unit: 'Ban NVT' },
            { name: 'Nguyễn Thị Trinh', unit: 'Ban NVT' },
            { name: 'Nguyễn Thu Thủy', unit: 'Ban NVT' },
            { name: 'Nguyễn Anh Tuấn', unit: 'Ban NVT' },
            { name: 'Vũ Thị Thu Thủy', unit: 'Ban NVT' },
            { name: 'Nguyễn Hải Anh', unit: 'Ban NVT' },

        ];
        
        // --- Ánh xạ các key câu hỏi với văn bản đầy đủ ---
        const questionMap = {
            q1_1: "1.1. Về Phương pháp và Cách thức xây dựng quy trình:",
            q1_2: "1.2. Cần điều chỉnh, bổ sung những nội dung nào?",
            q2_i: "2. Dự thảo quy trình đã đáp ứng yêu cầu 'Quản lý theo đối tượng' chưa?",
            q2_ii: "2. Dự thảo quy trình đã đáp ứng yêu cầu 'Lấy Người nộp thuế làm trung tâm' chưa?",
            q2_iii: "2. Dự thảo quy trình đã đáp ứng yêu cầu 'Tuân thủ các quy định hiện hành' chưa?",
            q3_1: "3.1. Dự thảo quy trình đã bao gồm đầy đủ các bước nghiệp vụ cần thiết chưa?",
            q3_2: "3.2. Cần bổ sung thêm những bước nghiệp vụ hoặc yêu cầu thông tin, dữ liệu nào?",
            q4_1: "4.1. Bạn đánh giá thế nào về tính khả thi của kế hoạch hoàn thành các quy trình trong tháng 8/2025?",
            q4_2: "4.2. Đề xuất của bạn là gì để đảm bảo về mặt thời gian cũng như chất lượng?",
        };
        
        // --- Ánh xạ câu hỏi với loại câu hỏi (để hiển thị kết quả) ---
        const questionTypeMap = {
            'q1_1': 'text',
            'q1_2': 'text',
            'q2_i': 'radio',
            'q2_ii': 'radio',
            'q2_iii': 'radio',
            'q3_1': 'radio',
            'q3_2': 'text',
            'q4_1': 'radio',
            'q4_2': 'text',
        };

        // --- Hàm cho Modal/Alert UI tùy chỉnh ---
        function showModal(message, type = 'success') {
            const modal = document.getElementById('custom-modal');
            const modalMessage = document.getElementById('modal-message');
            const modalIcon = document.getElementById('modal-icon');

            modalMessage.textContent = message;
            modalIcon.innerHTML = type === 'success' ? '<i class="fas fa-check-circle text-green-500"></i>' : '<i class="fas fa-exclamation-triangle text-red-500"></i>';
            modal.classList.add('active');
            
            setTimeout(() => {
                modal.classList.remove('active');
            }, 3000);
        }

        function showLoading() {
            document.getElementById('loading-overlay').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loading-overlay').classList.remove('active');
        }

        // --- Hàm kiểm tra chỉ các câu hỏi lựa chọn (radio) là bắt buộc ---
        function validateForm() {
            const radioGroups = ['q2_i', 'q2_ii', 'q2_iii', 'q3_1', 'q4_1'];
            for (const groupName of radioGroups) {
                const radioGroup = document.querySelectorAll(`input[name="${groupName}"]`);
                let isChecked = false;
                radioGroup.forEach(radio => {
                    if (radio.checked) {
                        isChecked = true;
                    }
                });
                if (!isChecked) {
                    return false; // Trả về false nếu có bất kỳ nhóm radio nào chưa được chọn
                }
            }
            return true; // Trả về true nếu tất cả các nhóm radio đã được chọn
        }

        // --- Hàm xử lý gửi form tới Firestore ---
        const handleSubmit = async (event) => {
            event.preventDefault();

            if (!isAuthReady) {
                showModal("Hệ thống chưa sẵn sàng, vui lòng kiểm tra kết nối.", "error");
                return;
            }
            
            if (!validateForm()) {
                showModal("Vui lòng trả lời tất cả các câu hỏi lựa chọn.", "error");
                return;
            }

            const form = event.target;
            const submissionData = {
                respondent_name: document.getElementById('respondent_name').value || "Người ẩn danh",
                unit: document.getElementById('unit').value || "Không rõ đơn vị",
                q1_1: document.getElementById('q1_1').value,
                q1_2: document.getElementById('q1_2').value,
                q2_i: form.elements['q2_i'].value,
                q2_ii: form.elements['q2_ii'].value,
                q2_iii: form.elements['q2_iii'].value,
                q3_1: form.elements['q3_1'].value,
                q3_2: document.getElementById('q3_2').value,
                q4_1: form.elements['q4_1'].value,
                q4_2: document.getElementById('q4_2').value,
                timestamp: new Date().toISOString(),
            };

            showLoading();
            try {
                // Sử dụng một collection cố định cho ứng dụng độc lập
                const surveyCollectionPath = `standalone-survey-app/submissions/data`;
                await addDoc(collection(db, surveyCollectionPath), submissionData);
                console.log("Document added successfully.");
                
                showModal("Gửi khảo sát thành công!", "success");
                form.reset();
            } catch (error) {
                console.error("Error adding document: ", error);
                showModal("Có lỗi xảy ra khi gửi khảo sát. Vui lòng thử lại.", "error");
            } finally {
                hideLoading();
            }
        };
        
        // --- Hàm để lấy và hiển thị kết quả từ Firestore ---
        const fetchAndRenderResults = () => {
            if (!isAuthReady) {
                document.getElementById('resultsContent').innerHTML = `<p class="text-center text-red-500">Không thể tải kết quả. Vui lòng kiểm tra cấu hình Firebase.</p>`;
                return;
            }

            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = `<p class="text-center text-gray-500">Đang tải kết quả...</p>`;
            
            const surveyCollectionPath = `standalone-survey-app/submissions/data`;
            const q = query(collection(db, surveyCollectionPath));

            onSnapshot(q, (querySnapshot) => {
                const submissions = [];
                querySnapshot.forEach((doc) => {
                    submissions.push(doc.data());
                });
                
                renderResults(submissions);
            });
        };

        const colorMap = {
            'Có': 'var(--chart-color-2)',
            'Không': 'var(--chart-color-4)',
            'Rất khả thi': 'var(--chart-color-2)',
            'Khả thi': 'var(--chart-color-1)',
            'Bình thường': 'var(--chart-color-3)',
            'Không khả thi': 'var(--chart-color-4)',
        };

        // --- Hàm tạo UI cho trang kết quả ---
        const renderResults = (submissions) => {
            const resultsContent = document.getElementById('resultsContent');
            resultsContent.innerHTML = ''; // Clear previous results

            if (submissions.length === 0) {
                resultsContent.innerHTML = `<p class="text-center text-gray-500 text-lg italic">Chưa có dữ liệu khảo sát.</p>`;
                return;
            }
        
            resultsContent.innerHTML += `<p class="text-center text-xl mb-6">Tổng số lượt khảo sát: <span class="font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400">${submissions.length}</span></p>`;
            
           
            // --- Phần thống kê theo đơn vị công tác ---
            const unitCounts = submissions.reduce((acc, curr) => {
                const unit = curr.unit || 'Không rõ đơn vị';
                acc[unit] = (acc[unit] || 0) + 1;
                return acc;
            }, {});

            let unitStatsHTML = `<div class="form-section">
                                    <h3 class="text-2xl font-semibold mb-4">Thống kê theo đơn vị công tác</h3>
                                    <ul class="space-y-2">`;
            for (const [unit, count] of Object.entries(unitCounts)) {
                unitStatsHTML += `<li class="flex justify-between items-center bg-white bg-opacity-30 rounded-lg p-2">
                                    <span class="font-medium">${unit}</span>
                                    <span class="font-bold text-lg">${count}</span>
                                 </li>`;
            }
            unitStatsHTML += `</ul></div>`;
            resultsContent.innerHTML += unitStatsHTML;

            // --- Phần tổng hợp các câu hỏi lựa chọn (radio) ---
            const renderRadioSummary = (title, key) => {
                const counts = submissions.reduce((acc, curr) => {
                    const value = curr[key];
                    if (value) {
                        acc[value] = (acc[value] || 0) + 1;
                    }
                    return acc;
                }, {});

                const total = Object.values(counts).reduce((sum, value) => sum + value, 0);
                if (total === 0) return '';
                
                let html = `<div class="form-section">
                                <h3 class="text-2xl font-semibold mb-4">${title}</h3>
                                <div class="space-y-2">`;
                
                for (const [option, count] of Object.entries(counts)) {
                    const percentage = total > 0 ? ((count / total) * 100).toFixed(0) : 0;
                    const color = colorMap[option] || 'var(--chart-color-5)';
                    html += `<div class="summary-item">
                                <div class="label">
                                    <span class="color-box" style="background-color: ${color};"></span>
                                    <span>${option}</span>
                                </div>
                                <span class="font-bold">${count} (${percentage}%)</span>
                             </div>`;
                }
                
                html += `   </div>
                         </div>`;
                return html;
            };

            resultsContent.innerHTML += renderRadioSummary("Phần II: Đáp ứng yêu cầu 'Quản lý theo đối tượng'", 'q2_i');
            resultsContent.innerHTML += renderRadioSummary("Phần II: Đáp ứng yêu cầu 'Lấy NNT làm trung tâm'", 'q2_ii');
            resultsContent.innerHTML += renderRadioSummary("Phần II: Đáp ứng yêu cầu 'Tuân thủ các quy định hiện hành'", 'q2_iii');
            resultsContent.innerHTML += renderRadioSummary("Phần III: Sự đầy đủ của các bước nghiệp vụ", 'q3_1');
            resultsContent.innerHTML += renderRadioSummary("Phần IV: Tính khả thi của kế hoạch tháng 8/2025", 'q4_1');
            
            // --- Phần tổng hợp các câu hỏi dạng text ---
            const renderTextSummary = (title, key) => {
                const answers = submissions.map(s => s[key]).filter(a => a && a.trim() !== '');
                if (answers.length === 0) return '';

                let html = `<div class="form-section">
                                <h3 class="text-2xl font-semibold mb-4">${title}</h3>
                                <ul class="list-disc list-inside space-y-2">`;
                answers.forEach(answer => {
                    html += `<li class="bg-white bg-opacity-30 rounded-lg p-2">${answer}</li>`;
                });
                html += `   </ul>
                         </div>`;
                return html;
            };

            resultsContent.innerHTML += renderTextSummary("Tổng hợp ý kiến về Phương pháp và Cách thức xây dựng quy trình", 'q1_1');
            resultsContent.innerHTML += renderTextSummary("Tổng hợp ý kiến về điều chỉnh, bổ sung Phương pháp xây dựng quy trình", 'q1_2');
            resultsContent.innerHTML += renderTextSummary("Tổng hợp ý kiến về việc bổ sung bước nghiệp vụ/yêu cầu dữ liệu", 'q3_2');
            resultsContent.innerHTML += renderTextSummary("Tổng hợp đề xuất để đảm bảo thời gian và chất lượng", 'q4_2');


            // --- Phần Kết quả chi tiết (Individual responses) ---
            let detailedResultsHTML = `<div class="form-section">
                                        <h3 class="text-2xl font-semibold mb-4">Kết quả chi tiết khảo sát</h3>
                                        <div class="mb-4">
                                            <input type="text" id="search-respondent" placeholder="Tìm kiếm theo tên người trả lời..." class="w-full p-3 rounded-xl bg-white bg-opacity-50 backdrop-blur-sm border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all">
                                        </div>
                                        <div id="detailedResultsList" class="space-y-4">`;
            
            submissions.forEach((submission) => {
                const respondentName = submission.respondent_name || "Người ẩn danh";
                const unit = submission.unit || "Không rõ";
                const timestamp = submission.timestamp ? new Date(submission.timestamp) : null;
                const formattedDate = timestamp ? `${timestamp.getHours()}:${timestamp.getMinutes()} ngày ${timestamp.getDate()}/${timestamp.getMonth() + 1}/${timestamp.getFullYear()}` : 'Không rõ thời gian';
                
                detailedResultsHTML += `<div class="detailed-result-card visible" data-name="${respondentName.toLowerCase()}">
                                            <div class="detailed-result-header">
                                                <p><span class="font-bold">${respondentName}</span> - ${unit} <br><span class="text-sm text-gray-500">${formattedDate}</span></p>
                                                <span class="toggle-icon"><i class="fas fa-chevron-down"></i></span>
                                            </div>
                                            <div class="detailed-result-content">`;
                
                for (const key in submission) {
                    if (questionMap[key] && questionTypeMap[key] === 'text' && submission[key]) {
                        const questionText = questionMap[key];
                        const answer = submission[key];
                        detailedResultsHTML += `<div class="question-detail">
                                                    <strong>${questionText}</strong>
                                                    <p class="text-gray-700">${answer}</p>
                                                </div>`;
                    }
                }
                
                for (const key in submission) {
                    if (questionMap[key] && questionTypeMap[key] === 'radio' && submission[key]) {
                        const questionText = questionMap[key];
                        const answer = submission[key];
                        detailedResultsHTML += `<div class="question-detail">
                                                    <strong>${questionText}</strong>
                                                    <p class="text-gray-700">${answer}</p>
                                                </div>`;
                    }
                }

                detailedResultsHTML += `    </div>
                                        </div>`;
            });

            detailedResultsHTML += `    </div>
                                     </div>`;

            resultsContent.innerHTML += detailedResultsHTML;
            
            // Add event listeners for accordion functionality
            document.querySelectorAll('.detailed-result-header').forEach(header => {
                header.addEventListener('click', () => {
                    header.classList.toggle('active');
                    const content = header.nextElementSibling;
                    if (content.classList.contains('active')) {
                        content.classList.remove('active');
                        content.style.maxHeight = null;
                    } else {
                        content.classList.add('active');
                        content.style.maxHeight = content.scrollHeight + "px";
                    }
                });
            });

            // Add search functionality
            const searchInput = document.getElementById('search-respondent');
            searchInput.addEventListener('input', (e) => {
                const searchValue = e.target.value.toLowerCase();
                document.querySelectorAll('.detailed-result-card').forEach(card => {
                    const name = card.getAttribute('data-name');
                    if (name.includes(searchValue)) {
                        card.classList.add('visible');
                    } else {
                        card.classList.remove('visible');
                    }
                });
            });
        };
        
        // --- Logic chuyển đổi giao diện ---
        function switchView(view) {
            const surveyContainer = document.getElementById('surveyContainer');
            const resultsContainer = document.getElementById('resultsContainer');
            const mainTitle = document.getElementById('mainTitle');
            
            if (view === 'form') {
                surveyContainer.classList.remove('hidden');
                resultsContainer.classList.add('hidden');
                mainTitle.textContent = "Khảo sát ý kiến về Dự thảo Quy trình nghiệp vụ khung";
            } else {
                surveyContainer.classList.add('hidden');
                resultsContainer.classList.remove('hidden');
                mainTitle.textContent = "Tổng hợp kết quả khảo sát";
                fetchAndRenderResults(); // Fetch and render results when switching to this view
            }
        }
        
        // --- Hàm để điền datalist và cập nhật đơn vị công tác ---
        function populateDatalist() {
            const datalist = document.getElementById('employees');
            if (datalist) {
                datalist.innerHTML = employeeData.map(employee => `<option value="${employee.name}"></option>`).join('');
            }
        }
        
        function updateUnit() {
            const nameInput = document.getElementById('respondent_name');
            const unitInput = document.getElementById('unit');
            const selectedName = nameInput.value;
            const employee = employeeData.find(emp => emp.name === selectedName);
            
            if (employee) {
                unitInput.value = employee.unit;
            } else {
                unitInput.value = ''; // Xóa nếu tên không khớp
            }
        }
        
        // --- Xử lý sự kiện khi tải trang ---
        window.onload = function() {
            populateDatalist();
            const surveyForm = document.getElementById('surveyForm');
            surveyForm.addEventListener('submit', handleSubmit);
            setupAuth();
        };

        // --- Expose functions to global scope for HTML events ---
        window.switchView = switchView; 
        window.updateUnit = updateUnit;
    </script>
</body>
</html>



